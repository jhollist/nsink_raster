<!DOCTYPE html>
<html>
  <head>
    <title>n-sink rasterization: process outline</title>
    <meta charset="utf-8">
    <meta name="author" content="Jeffrey Hollister" />
    <meta name="date" content="2018-08-10" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# n-sink rasterization: process outline
### Jeffrey Hollister
### 2018-08-10

---



---
class: center, middle

# Acquire 

---
# Acquire: Summary

.left[
- NHD
- SSURGO
- NLCD Impervious Surface
]

.right[
![Image of WS with all data layers]()
]
---
# Acquire: NHD+ 12-digit HUCs

.left[
- Source file
  - NHDPlusV21_NE_01_WBDSnapshot_03.7z
- Source data
  - Shapefile
  - NHDPlusNE/NHDPlus01/WBDSnapshot/WBD/WBD_Subwatershed]

.right[
![Image of NE HUCS]()
]
---
# Acquire: NHD+ Flowlines

.left[
- Source file
  - NHDPlusV21_NE_01_NHDSnapshot_04.7z
- Source data
  - Shapefile
  - NHDPlusNE/NHDPlus01/NHDSnapshot/Hydrography/NHDFlowline
]

.right[
![Image of NE flowlines]()
]

---
# Acquire: NHD+ Waterbodies

.left[
- Source file
  - NHDPlusV21_NE_01_NHDSnapshot_04.7z
- Source data
  - Shapefile
  - NHDPlusNE/NHDPlus01/NHDSnapshot/Hydrography/NHDWaterbody
]

.right[
![Image of NE waterbodies]()
]

---
# Acquire: NHD+ Flow Direction

.left[
- Source file
  - NHDPlusV21_NE_01_01a_FdrFac_01.7z
- Source data
  - ESRI Raster
  - NHDPlusNE/NHDPlus01/NHDPlusFdrFac01a/fdr
]

.right[
![Image of NE FD]()
]

---
# Acquire: NHD+ Data Tables

.left[
- Source files
  - NHDPlusV21_NE_01_NHDPlusAttributes_08.7z
  - NHDPlusV21_NE_01_EROMExtension_05.7z
- Source Data
  - dbf
  - Time of Travel (TOTMA): NHDPlusNE/NHDPlus01/NHDPlusAttributes/PlusFlowlineVAA.dbf
  - Discharge (Q0001E): NHDPlusNE/NHDPlus01/EROMExtension/EROM_MA0001.DBF 
]

.right[
![Image of NE Data tables]()
]

---
# Acquire: SSURGO

.left[
- Basis for Hydric Soils
- Anything but straightforward (more later)
- Download from: ???
- Which pieces: ???
]

.right[
![image of diagram of mu to component to percent]()
]
---
# Acquire: Impervious Surface

.left[
- used to mask out hydric soils
- source data: 2007 NLCD Impervious
- source files: ???
]

.right[
![Image of impervious removed from hydric]()
]

---
class: center, middle

# Clean

---

#Clean: Specific HUC

- NHD+ is for all of New England
- Narrow down to Specific HUC 12 
- Niantic as example

---

#Clean: Raster Conformity

- Rasters will have small differences
- Need to force to same origin and projection


```
class       : RasterLayer 
dimensions  : 31405, 25845, 811662225  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 1643925, 2419275, 2200425, 3142575  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 
+x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
 
 
class       : RasterLayer 
dimensions  : 535, 378, 202230  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 1947688, 1959028, 2281794, 2297844  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 
+x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
```

---

# Acquire and Clean: Miscellany

- As currently written:
  - Provides NHD+ data for all of New England
  - Gets impervious and SSURGO for specific HUC
  - Cache data locally
  - Takes ~ 15 minutes for all of this
    - 90% of that is downloading SSURGO

---
class: center, middle

# Create 

---
# Create: removal raster
- Land removal
- Lake removal
- Stream removal

- notes: generate at 10m, filter, re-scale to 30m
  - need explanation/example as to why this is good...


---
# Create: Land removal

- SSURGO hydric soils
- Impervious Surface masked out
- Map units and Components to percent hydric

![image of diagram of mu to component to percent]()



??? 
  - Map Unit - spatial
  - Each Map Unit is made up of any number of non-spatial components
  - A component is classified as hydric or not
  - A component takes up a percentage of the map unit area
  - All components of a map unit sum to 100
- Hydric Percentage
  - sum of the percentage of hydirc components
  - a Map Unit is perecent from 0% Hydric to 100% Hydric
  - in practice most are either a lot of hydric area or a little hydric area
- Spatial - map Unit
  - Associated components
- Non-spatial - component
  - Hydric Boolean
  - Hydric Percent
- Output
  - Polygons with total percent hydric

---
# Create: type raster
- start with removal rasters and convert positive removal values to a type

???
test

---
# Create: Combine removal and type
- raster stack

---
# Create: Flowpath 
- 

---
class: center, middle

# Summarize 

---
# Summarize: Extract 

---
# Summarize: Clean

---
# Summarize: Report

---
class: center, middle

# Now what?

---
# Now what?: Static Maps
- Which static maps to create?
- Brute force
- Something else?
  - Flow accumulation?

---
# Now what?: R Package
- Code for doing this is a hot-mess
- R package is obvious solution
- Facilitates use with other tools
  - e.g. ArcGIS R Bridge

---
# Now what?: Web UI
- Stay in R?
  - Shiny
- ArcGIS?
  - Would need to use R Bridge for Arc
    - &lt;https://r-arcgis.github.io/&gt;
  - Or...
  - Re-work some portion of the workflow
    - Flow path generation
    - Extracting
    - Summarizing
---
class: center, middle

# Thanks and Questions!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
