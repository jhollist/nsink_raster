---
title: "n-sink rasterization: process outline"
author: "Jeffrey Hollister"
date: "2018-08-10"
output:
  xaringan::moon_reader:
    css: ["default", "custom.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
---
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

---
class: center, middle

# Acquire 

---
# Acquire: Summary

.left[
- NHD
- SSURGO
- NLCD Impervious Surface
]

.right[
![Image of WS with all data layers]()
]
---
# Acquire: NHD+ 12-digit HUCs

.left[
- Source file
  - NHDPlusV21_NE_01_WBDSnapshot_03.7z
- Source data
  - Shapefile
  - NHDPlusNE/NHDPlus01/WBDSnapshot/WBD/WBD_Subwatershed]

.right[
![Image of NE HUCS]()
]
---
# Acquire: NHD+ Flowlines

.left[
- Source file
  - NHDPlusV21_NE_01_NHDSnapshot_04.7z
- Source data
  - Shapefile
  - NHDPlusNE/NHDPlus01/NHDSnapshot/Hydrography/NHDFlowline
]

.right[
![Image of NE flowlines]()
]

---
# Acquire: NHD+ Waterbodies

.left[
- Source file
  - NHDPlusV21_NE_01_NHDSnapshot_04.7z
- Source data
  - Shapefile
  - NHDPlusNE/NHDPlus01/NHDSnapshot/Hydrography/NHDWaterbody
]

.right[
![Image of NE waterbodies]()
]

---
# Acquire: NHD+ Flow Direction

.left[
- Source file
  - NHDPlusV21_NE_01_01a_FdrFac_01.7z
- Source data
  - ESRI Raster
  - NHDPlusNE/NHDPlus01/NHDPlusFdrFac01a/fdr
]

.right[
![Image of NE FD]()
]

---
# Acquire: NHD+ Data Tables

.left[
- Source files
  - NHDPlusV21_NE_01_NHDPlusAttributes_08.7z
  - NHDPlusV21_NE_01_EROMExtension_05.7z
- Source Data
  - dbf
  - Time of Travel (TOTMA): NHDPlusNE/NHDPlus01/NHDPlusAttributes/PlusFlowlineVAA.dbf
  - Discharge (Q0001E): NHDPlusNE/NHDPlus01/EROMExtension/EROM_MA0001.DBF 
]

.right[
![Image of NE Data tables]()
]

---
# Acquire: SSURGO

.left[
- Basis for Hydric Soils
- Anything but straightforward (more later)
- Download from: ???
- Which pieces: ???
]

.right[
![image of diagram of mu to component to percent]
]
---
# Acquire: Impervious Surface

---
# Acquire: Miscellany

- approximate download time
- what is needed to download
- provides all data for all of NE
- cache data locally 

---
class: center, middle

# Clean

---

#Clean: Specific HUC

---

#Clean: Raster Conformity

---
class: center, middle

# Create 

---
# Create: removal raster
- Land removal
- Lake removal
- Stream removal

- notes: generate at 10m, filter, re-scale to 30m
  - need explanation/example as to why this is good...

---
# Create: Land removal

.left[
- SSURGO is the basis
- Only removal from hydric soil
- Hydric soil that are also impervious surface have no removal
- What is left:
  - Map Unit - spatial
  - Each Map Unit is made up of any number of non-spatial components
  - A component is classified as hydric or not
  - A component takes up a percentage of the map unit area
  - All components of a map unit sum to 100
- Hydric Percentage
  - sum of the percentage of hydirc components
  - a Map Unit is perecent from 0% Hydric to 100% Hydric
  - in practice most are either a lot of hydric area or a little hydric area
- Spatial - map Unit
  - Associated components
- Non-spatial - component
  - Hydric Boolean
  - Hydric Percent
- Output
  - Polygons with total percent hydric
]

.right[
![image of diagram of mu to component to percent]
]
---
# Create: type raster
- start with removal rasters and convert positive removal values to a type

---
# Create: Combine removal and type
- raster stack

---
# Create: Flowpath 
- 

---
class: center, middle

# Summarize 

---
# Summarize: Extract 

---
# Summarize: Clean

---
# Summarize: Report

---
class: center, middle

# Now what?

---
# Now what?: Static Maps
- Which static maps to create?
- Brute force
- Something else?
  - Flow accumulation?

---
# Now what?: R Package
- Code for doing this is a hot-mess
- R package is obvious solution
- Facilitates use with other tools
  - e.g. ArcGIS R Bridge

---
# Now what?: Web UI
- Stay in R?
  - Shiny
- ArcGIS?
  - Would need to use R Bridge for Arc
    - <https://r-arcgis.github.io/>
  - Or...
  - Re-work some portion of the workflow
    - Flow path generation
    - Extracting
    - Summarizing
---
class: center, middle

# Thanks and Questions!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).